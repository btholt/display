//////////////////////////////////////////////////
//author:Dane Hansen/////////////////////////////
//www.danehansen.com////////////////////////////
///////////////////////////////////////////////

Sprite.ENTER_FRAME="onEnterFrame";Sprite.COMPLETE="onComplete";Sprite.REVERSE_COMPLETE="onReverseComplete";
function Sprite(a,c,b,d,e){this.element=a;this._columns=c;this._totalFrames=b;this.loop=d||!1;this.frameRate=e||60;this._actualFrame=this._frame=this._progress=0;this._dest=null;this._callbacks={};this.resize=this.resize.bind(this);this.progress=this.progress.bind(this);this.frame=this.frame.bind(this);this.progressTo=this.progressTo.bind(this);this.frameTo=this.frameTo.bind(this);this.play=this.play.bind(this);this.rewind=this.rewind.bind(this);this.stop=this.stop.bind(this);this.prevFrame=this.prevFrame.bind(this);
this.nextFrame=this.nextFrame.bind(this);this.addEventListener=this.addEventListener.bind(this);this.removeEventListener=this.removeEventListener.bind(this);this.dispatchEvent=this.dispatchEvent.bind(this);this.resize()}Sprite.prototype.resize=function(){this._width=this.element.offsetWidth;this._height=this.element.offsetHeight;this._showFrame(this._frame)};
Sprite.prototype.progress=function(a){if("number"!=typeof a)return this._progress;a=this._limit(a);if(this._progress!=a)var c=!0;this._progress=a;var b=this._progressToFrame(a);for(this._frame=b;0>b;)b+=this._totalFrames;b%=this._totalFrames;this._actualFrame!=b&&(this._showFrame(b),this.dispatchEvent(Sprite.ENTER_FRAME));c&&(this.loop||0!=a?0==a%1&&this.dispatchEvent(Sprite.COMPLETE):this.dispatchEvent(Sprite.REVERSE_COMPLETE))};
Sprite.prototype.frame=function(a){if("number"!=typeof a)return this._frame;this.progress(this._frameToProgress(a))};Sprite.prototype.progressTo=function(a,c){a=this._limit(a);if(this._progress!==a&&this._dest!==a){this._dest=a;var b=Math.abs(a-this._progress)*this._totalFrames/this.frameRate;TweenLite.to(this,b,{progress:a,ease:Linear.easeNone,onComplete:this._resetDest,onCompleteScope:this,onCompleteParams:[c]})}};Sprite.prototype.frameTo=function(a){this.progressTo(this._frameToProgress(a))};
Sprite.prototype.nextFrame=function(){this.frame(this._frame+1)};Sprite.prototype.prevFrame=function(){this.frame(this._frame-1)};Sprite.prototype.play=function(a){this.progressTo(Math.round(this._progress+.5),!0===a?1:null)};Sprite.prototype.rewind=function(a){this.progressTo(Math.round(this._progress-.500000001),!0===a?-1:null)};Sprite.prototype.stop=function(){this._dest=null;TweenLite.killTweensOf(this)};
Sprite.prototype.addEventListener=function(a,c){var b=this._callbacks[a];b||(b=[],this._callbacks[a]=b);-1==b.indexOf(c)&&b.push(c)};Sprite.prototype.removeEventListener=function(a,c){var b=this._callbacks[a];if(b){var d=b.indexOf(c);0<=d&&b.splice(d,1)}};Sprite.prototype.dispatchEvent=function(a){var c=this._callbacks[a];if(c){a={target:this,type:a};for(var b=0,d=c.length;b<d;b++)c[b](a)}};
Sprite.prototype._showFrame=function(a){this._actualFrame=a;this.element.style.backgroundPosition=-(a%this._columns*this._width)+"px "+-(this._height*Math.floor(a/this._columns))+"px"};Sprite.prototype._progressToFrame=function(a){return 0>a?Math.ceil(a*(this._totalFrames-(this.loop?0:1))):Math.floor(a*(this._totalFrames-(this.loop?0:1)))};Sprite.prototype._frameToProgress=function(a){return this.loop?a/(this._totalFrames-0):a/(this._totalFrames-1)};
Sprite.prototype._limit=function(a){return this.loop?a:Math.max(0,Math.min(a,1))};Sprite.prototype._resetDest=function(a){this._dest=null;1==a?this.progressTo(this._progress+1,a):-1==a&&this.progressTo(this._progress-1,a)};